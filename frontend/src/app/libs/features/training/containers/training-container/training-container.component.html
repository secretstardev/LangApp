<ng-container
  *ngIf="{
    drills: trainingStore.drills$ | async,
    completedDrills: trainingStore.completedDrills$ | async,
    currentCard: trainingStore.currentCard$ | async,
    currentDrill: trainingStore.currentDrill$ | async
  } as obs"
>
  <ng-container *ngIf="obs.drills.status === 'success' && obs.currentCard">
    <app-training-toolbar
      class="toolbar"
      [drillsLength]="obs.drills.data?.length"
      [completedDrillsLength]="obs.completedDrills.length"
      (selectDictionary)="selectDictionary($event)"
      (hideQuestion)="hideQuestion(obs.currentCard)"
      (clickSetting)="openSetting()"
    ></app-training-toolbar>

    <ng-container *ngIf="obs.drills.data?.length">
      <ng-container [ngSwitch]="obs.currentCard.cardType">
        <app-training-card-kanji
          *ngSwitchCase="'kanjiInfo'"
          class="card-window {{ obs.currentCard.cardType }}"
          [card]="$any(obs.currentCard)"
          (clickMore)="clickWordMore($event)"
          (clickPlay)="clickPlay($event)"
        ></app-training-card-kanji>
        <app-training-card-word
          *ngSwitchCase="'wordInfo'"
          class="card-window"
          [card]="$any(obs.currentCard)"
          (clickMore)="clickWordMore($event)"
          (clickPlay)="clickPlay($event)"
        ></app-training-card-word>
        <ng-container *ngSwitchDefault>
          <app-training-card-question
            *ngIf="obs.currentCard.cardType !== 'typeFuriganaForWholeWord'"
            class="card-window {{ obs.currentCard.cardType }}"
            [card]="$any(obs.currentCard)"
            [drill]="obs.currentDrill"
            (clickPlay)="clickPlay($event)"
            (checkAnswer)="checkIndexAnswer($event, $any(obs.currentCard))"
            (nextQuestion)="nextQuestion()"
            (clickMore)="clickWordMore($event)"
            (disableAudioQuestion)="disableAudioQuestion($event)"
          ></app-training-card-question>
          <app-training-card-question-puzzle
            *ngIf="obs.currentCard.cardType === 'typeFuriganaForWholeWord'"
            class="card-window {{ obs.currentCard.cardType }}"
            [card]="$any(obs.currentCard)"
            [drill]="obs.currentDrill"
            (clickPlay)="clickPlay($event)"
            (clickMore)="clickWordMore($event)"
            (checkAnswer)="checkButtonsAnswer($event, $any(obs.currentCard))"
          ></app-training-card-question-puzzle>
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="!obs.drills.data?.length">
      <app-training-complete class="card-window" (linkClick)="completeLinkClick($event)"></app-training-complete>
    </ng-container>

    <app-training-footer
      *ngIf="obs.currentCard.cardType | trainingFooterAvailability"
      [isAnswered]="obs.currentDrill.isFinished"
      [hasAnswer]="obs.currentCard['question']"
      (clickContinue)="checkWithoutAnswer()"
      (clickDontRemember)="checkWithoutAnswer(false, obs.currentCard?.['audioUrls']?.[0])"
    ></app-training-footer>
  </ng-container>

  <ng-container *ngIf="!obs.currentCard">
    <button style="text-align: center; margin-top: 20px; height: 35px; font-size: 14px; margin: auto;" label="{{ 'Continue study' | translate }}" pButton></button>
  </ng-container>

  <ng-container *ngIf="obs.drills.status === 'loading'">
    <p-progressSpinner class="spinner"></p-progressSpinner>
  </ng-container>
</ng-container>
